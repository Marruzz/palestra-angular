<app-header />
<app-loading-spinner [isLoading]="isLoading" />

<div class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
  <div *ngIf="!isLoading" class="container mx-auto px-4 py-8 max-w-7xl">
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 mb-8">
      <div
        class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"
      >
        <div class="flex-1">
          <h1 class="text-4xl font-bold text-gray-900 mb-2">
            Dashboard Gestionale
          </h1>
          <p class="text-lg text-gray-600">
            Benvenuto nel pannello di controllo della palestra
          </p>
        </div>
        <div class="flex flex-col sm:flex-row gap-4">
          <button
            class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
            (click)="openUserModal()"
            [disabled]="isLoading"
          >
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
              ></path>
            </svg>
            Nuovo Utente
          </button>
          <button
            class="inline-flex items-center justify-center px-6 py-3 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200"
            (click)="setView('stats')"
            [disabled]="isLoading"
          >
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              ></path>
            </svg>
            Statistiche
          </button>
          <button
            class="inline-flex items-center justify-center px-4 py-3 text-gray-600 border border-gray-300 rounded-xl hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200"
            (click)="refreshAllData()"
            [disabled]="isLoading"
            title="Aggiorna tutti i dati"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              ></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="mb-8">
      <app-stats-cards-summary
        [stats]="stats"
        [isLoading]="isLoading"
        *ngIf="currentView != 'stats'"
      >
      </app-stats-cards-summary>
    </div>

    <div class="mb-8">
      <app-navigation-tabs
        [currentView]="currentView"
        (viewChange)="setView($event)"
      >
      </app-navigation-tabs>
    </div>

    <div *ngIf="isLoading" class="flex items-center justify-center py-12">
      <div class="flex items-center space-x-3">
        <div
          class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
        ></div>
        <span class="text-gray-600 font-medium"
          >Caricamento dati in corso...</span
        >
      </div>
    </div>

    <div class="space-y-8" *ngIf="!isLoading">
      <div
        class="bg-white rounded-2xl shadow-sm border border-gray-100"
        *ngIf="currentView === 'users'"
      >
        <app-users-management
          [users]="users"
          [showUserModal]="showUserModal"
          [userForm]="userForm"
          [selectedUser]="selectedUser"
          [corsi]="corsi"
          (userModalOpen)="openUserModal($event)"
          (userModalClose)="closeUserModal()"
          (userSave)="saveUser($event)"
          (userDelete)="deleteUser($event)"
        >
        </app-users-management>
      </div>

      <div
        class="bg-white rounded-2xl shadow-sm border border-gray-100"
        *ngIf="currentView === 'subscriptions'"
      >
        <app-subscriptions-management
          [subscriptions]="abbonamenti"
          [users]="users"
          [corsi]="corsi"
          [showSubscriptionModal]="showSubscriptionModal"
          [subscriptionForm]="subscriptionForm"
          [selectedAbbonamento]="selectedAbbonamento"
          (subscriptionModalOpen)="openSubscriptionModal($event)"
          (subscriptionModalClose)="closeSubscriptionModal()"
          (subscriptionSave)="saveSubscription()"
          (subscriptionDelete)="deleteSubscription($event)"
        >
        </app-subscriptions-management>
      </div>

      <div
        class="bg-white rounded-2xl shadow-sm border border-gray-100"
        *ngIf="currentView === 'accesses'"
      >
        <app-accesses-management
          [accesses]="ingressi"
          [users]="users"
          [stats]="stats"
          [showAccessModal]="showAccessModal"
          [accessForm]="accessForm"
          (accessModalOpen)="openAccessModal()"
          (accessModalClose)="closeAccessModal()"
          (accessRegister)="saveAccess()"
          (accessDelete)="deleteAccess($event)"
          (registerMultipleAccesses)="saveMultipleAccesses($event)"
        >
        </app-accesses-management>
      </div>
      <div
        class="bg-white rounded-2xl shadow-sm border border-gray-100"
        *ngIf="currentView === 'corsi'"
      >
        <app-corsi-management
          [corsi]="corsi"
          [showCorsoModal]="showCorsoModal"
          [corsoForm]="corsoForm"
          [selectedCorso]="selectedCorso"
          [isLoading]="isLoading"
          [errorMessage]="errorMessage"
          (corsoModalOpen)="openCorsoModal($event)"
          (corsoModalClose)="closeCorsoModal()"
          (corsoSave)="saveCorso()"
          (corsoDelete)="deleteCorso($event)"
          (refreshView)="refreshCurrentView()"
        >
        </app-corsi-management>
      </div>
      <div
        class="bg-white rounded-2xl shadow-sm border border-gray-100"
        *ngIf="currentView === 'stats'"
      >
        <app-stats-page [stats]="stats" [isLoading]="isLoading">
        </app-stats-page>
      </div>

      <div
        class="bg-white rounded-2xl shadow-sm border border-gray-100"
        *ngIf="!currentView"
      >
        <app-panoramica-utenti-selection
          [users]="users"
          [stats]="stats"
          (userEdit)="openUserModal($event)"
          (userDelete)="deleteUser($event)"
        >
        </app-panoramica-utenti-selection>
      </div>
    </div>
  </div>
</div>
